<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-compatible" content="ie-edge" />
        <link rel="stylesheet" href="css/stylesheet3.css"/>
        <title>Tankbeleg erfassen</title>
    </head>
    <script>
         Date.prototype.toDateInputValue = (function() {
            var local = new Date(this);
            local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
            return local.toJSON().slice(0,10);
        });
        
        document.addEventListener('DOMContentLoaded', (event) => {
            input_datum = document.getElementById('_datum');
            input_datum.value = new Date().toDateInputValue();
        });
        
        (async function init() {
            const response = await fetch('/tankdaten_erfassen/get-letzter-tankvorgang');
            console.log("response", response);
            const response_data = await response.json();
            console.log(JSON.stringify(response_data));
            document.getElementById('_kmStand').setAttribute('placeholder', response_data.recordset[0].kmStand);
            document.getElementById('_liter').setAttribute('placeholder', response_data.recordset[0].Liter);
            document.getElementById('_betrag').setAttribute('placeholder', response_data.recordset[0].Betrag);
            document.getElementById('_literpreis').setAttribute('placeholder', response_data.recordset[0].Literpreis);
            document.getElementById('_tankstelle').setAttribute('placeholder', response_data.recordset[0].Tankstelle);
        })();

        
        async function handleWerteSpeichern() {
            const payload = {
                Datum: document.getElementById('_datum').value, 
                kmStand: document.getElementById('_kmStand').value, 
                Liter: document.getElementById('_liter').value, 
                vollgetankt: document.getElementById('_vollgetankt').checked, 
                Betrag: document.getElementById('_betrag').value, 
                Literpreis: document.getElementById('_literpreis').value, 
                Tankstelle: document.getElementById('_tankstelle').value, 
                Sorte: document.querySelector('input[name="_sorte"]:checked').value
            };
            console.log(JSON.stringify(payload));
            
            const response = await fetch('tankdaten_erfassen/update', {
                method: "POST",
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });
            if (response.ok) {
                const jsonResponse = await response.json();
                console.log(jsonResponse)
                response_div = document.getElementById('response');
                response_div.innerHTML = '<p>' + JSON.stringify(jsonResponse) + '</p>';
                response_div.style.display = 'block';
            }
            else {
            response_div = document.getElementById('response');
            response_text = await response.text();
            document.write(response_text);
            }
        }
   </script>
    <body>
        <div class="level1">
            <div class="level2-1">
                <h2>Tankbeleg erfassen</h2>                
            </div>
            <div class="level2-2">
                <img src='images/111.14537851.jpg.14537862.jpg' alt="Hier sollte eigentlich eine schicke Tanksäule zu sehen sein.">
            </div>
            <div class="input-area">
                <div>
                    <label>Datum</label>
                </div>
                <div>
                    <input type="date" id='_datum'/>
                </div>
                <div>
                    <label>Km-Stand</label>
                </div>
                <div>
                    <input type="number" id='_kmStand' autocomplete="off" required step="1.0" min="4" max="299999"/>
                </div>
                <div>
                    <label>Liter</label>
                </div>
                <div class="liter-vollgetankt">
                    <input type="number" autocomplete="off" required step="0.01" min="5.0" max="70.0" id='_liter'/>
                    <div>
                        <input type="checkbox" id="_vollgetankt" checked>
                        <label for ="_vollgetankt">vollgetankt</label> 
                    </div>
                </div>
                <div>
                    <label>Betrag</label>
                </div>
                <div>
                    <input type="number" id='_betrag' autocomplete="off" required step="0.01" min="5.0" max="120.0"/>
                    <i>€</i>
                </div>
                <div>
                    <label>Literpreis</label>
                </div>
                <div>
                    <input type="number" id='_literpreis' autocomplete="off" step="0.1" min="120.0" max="220.0"/>
                    <i>ct/l</i>
                </div>
                <div>
                    <label>Tankstelle</label>
                </div>
                <div>
                    <input type="text" id='_tankstelle'/>
                </div>
                <div>
                    <label>Sorte</label>
                </div>
                <div class="sorte-e5-e10">
                    <div>
                        <input type="radio" id="_E5" name="_sorte" value="E5" checked>
                        <label for="_E5">E5</label>
                    </div>
                      
                    <div>
                        <input type="radio" id="_E10" name="_sorte" value="E10">
                        <label for="_E10">E10</label>
                    </div>
                </div>
           </div>
            <div class="level2-4">
                <button onclick="handleWerteSpeichern()">WERTE ÜBERNEHMEN</button>
            </div>
            <div class="level2-5">
                <span>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Doloremque facere nemo cum incidunt, quis itaque facilis, commodi ut nostrum quisquam consequatur beatae rerum eaque illo dicta! Dignissimos natus voluptatibus iure!</span>    
            </div>
        </div>
   </body>
</html>